<%- include("partials/header", { title: "Order Detail", subtitle: "Edit • Approve • Payment • Delivered", active: (order.status==='APPROVED'?'approved':'draft') }) %>

<div class="grid">
  <div class="card">
    <h2>Order #<%= order.id %></h2>
    <div class="chips">
      <span class="chip">Phone: <%= order.phone %></span>
      <span class="chip <%= order.status==='APPROVED' ? 'ok' : (order.status==='REJECTED' ? 'bad' : 'warn') %>">Status: <%= order.status %></span>
      <span class="chip <%= order.payment_status==='PAID' ? 'ok' : 'warn' %>">Payment: <%= order.payment_status %></span>
      <span class="chip ok">Total: ₹<%= order.total %></span>
    </div>
  </div>

  <div class="card">
    <h2>Edit Order</h2>

    <form method="POST" action="/admin/orders/<%= order.id %>/update">
      <div class="row row-2">
        <div>
          <label>Qty</label>
          <input name="qty" value="<%= order.qty %>" />
        </div>
        <div>
          <label>Price Per Unit</label>
          <input name="price_per_unit" value="<%= order.price_per_unit %>" />
        </div>
      </div>

      <div class="row row-2">
        <div>
          <label>Delivery Day</label>
          <select name="delivery_day">
            <option value="TODAY" <%= order.delivery_day === "TODAY" ? "selected" : "" %>>TODAY</option>
            <option value="TOMORROW" <%= order.delivery_day === "TOMORROW" ? "selected" : "" %>>TOMORROW</option>
          </select>
        </div>
        <div>
          <label>Current delivery rule</label>
          <input disabled value="Free delivery above ₹<%= settings.free_delivery_threshold %>" />
        </div>
      </div>

      <label>Address</label>
      <textarea name="address_snapshot" rows="3"><%= order.address_snapshot %></textarea>

      <button class="btn" type="submit">Save Changes</button>
    </form>
  </div>

  <div class="card">
    <h2>Actions</h2>

    <div class="row">
      <form method="POST" action="/admin/orders/<%= order.id %>/approve">
        <button class="btn" type="submit">Approve</button>
      </form>

      <form method="POST" action="/admin/orders/<%= order.id %>/delivered">
        <button class="btn warn" type="submit">Mark Delivered</button>
      </form>

      <form method="POST" action="/admin/orders/<%= order.id %>/reject">
        <button class="btn danger" type="submit">Reject</button>
      </form>
    </div>
  </div>

  <div class="card">
    <h2>Manual Payment</h2>

    <form method="POST" action="/admin/orders/<%= order.id %>/payment">
      <div class="row row-2">
        <div>
          <label>Status</label>
          <select name="payment_status">
            <option value="UNPAID" <%= order.payment_status === "UNPAID" ? "selected" : "" %>>UNPAID</option>
            <option value="PAID" <%= order.payment_status === "PAID" ? "selected" : "" %>>PAID</option>
          </select>
        </div>
        <div>
          <label>Method</label>
          <select name="payment_method">
            <option value="">--select--</option>
            <option value="UPI" <%= order.payment_method === "UPI" ? "selected" : "" %>>UPI</option>
            <option value="CASH" <%= order.payment_method === "CASH" ? "selected" : "" %>>CASH</option>
            <option value="OTHER" <%= order.payment_method === "OTHER" ? "selected" : "" %>>OTHER</option>
          </select>
        </div>
      </div>

      <label>Note</label>
      <textarea name="payment_note" rows="2"><%= order.payment_note || "" %></textarea>

      <button class="btn secondary" type="submit">Update Payment</button>
    </form>
  </div>
</div>

<%- include("partials/footer", { active: (order.status==='APPROVED'?'approved':'draft') }) %>


